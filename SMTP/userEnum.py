#!/usr/bin/python
#Castro Rendon Virgilio

import sys, socket, os.path

if len(sys.argv) != 3:
	print "Use: ./userEnum.py IP username|usersFile"
	exit(0)

#Si es un archivo, regresa una lista de todos los usuarios que tiene, si no regresa un lista de un usuario
def readUsers(user):
	if os.path.isfile(user):
		with open(user) as f:
			return f.read().splitlines()
	return [user]

#Verifica la existencia de cada usuario enviado
if __name__ == '__main__':
	try:
		for u in readUsers(sys.argv[2]):
			s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
			s.connect((sys.argv[1],25))
			s.recv(1024)
			s.send('VRFY %s \r\n' % u)
			if '252' in s.recv(1024):
				print "EXISTS:\t%s" % u
			s.close()
	except:
		print "Unkown error"
