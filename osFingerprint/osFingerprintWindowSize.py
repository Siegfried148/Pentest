#!/usr/bin/python
#Castro Rendon Virgilio
from scapy.all import *
import re

if len(sys.argv) != 3:
	print "uso osFingerprint2.py ip port"
	exit(0)
#Diccionario de sistemas oeprativos y window size
so = {"5840":["Linux"], "5720":["Android"],"65535":["Windows XP","FreeBSD"], "8192":["Windows"], "29200":["Linux"]}
packet = IP(dst=sys.argv[1])/TCP(dport=int(sys.argv[2]),flags="S") #Se forma el paquete
try:
	window = re.search(r"window=([0-9]+) ", str(srloop(packet, count=1, verbose=False)[0][0])) #Se envia el paquete y busca el tamano de ventana
	print "\n(TCP Window Size: %s)\nLa direccion IP/host %s puede ser:" % (window.group(1),sys.argv[1])
	for s in so[window.group(1)]:
		print "\t"+s
except Exception as e:
	print str(e)
	print "\n\nERROR: No se pudo obtener el sistema operativo"
